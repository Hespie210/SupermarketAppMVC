<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>All Receipts - Admin</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <link rel="stylesheet" href="/css/theme.css">
</head>
<body>
  <%- include('partials/header') %>

  <div class="container mt-4">
    <h2>All Receipts (Admin)</h2>
    <hr>

    <% if (!purchases || purchases.length === 0) { %>
      <p>No purchases have been made yet.</p>
    <% } else { %>
<table class="table table-bordered text-center align-middle" style="width: 95%; margin: auto;">
  <thead class="table-light">
    <tr>
      <th>Receipt</th>
      <th>Receipt ID</th>
      <th>Date/Time</th>
      <th>User</th>
      <th>Email</th>
      <th>Product</th>
      <th>Qty</th>
      <th>Total</th>
      <th>Action</th>
    </tr>
  </thead>

  <tbody>
    <% purchases.forEach(p => { %>
      <tr>
        <td><%= p.id %></td>

        <td><%= p.receiptTimestamp %></td>

        <td>
          <%= p.createdAt && p.createdAt.toLocaleString
                ? p.createdAt.toLocaleString()
                : p.createdAt %>
        </td>

        <td><%= p.username %></td>
        <td><%= p.email %></td>

        <td><%= p.productName %></td>
        <td><%= p.quantity %></td>

        <td>$<%= Number(p.subtotal).toFixed(2) %></td>

        <td>
          <a 
            href="/admin/purchases/<%= p.userId %>/<%= p.receiptTimestamp %>" 
            class="btn btn-sm btn-primary"
          >
            View
          </a>
        </td>
      </tr>
    <% }) %>
  </tbody>
</table>

    <% } %>
  </div>
</body>
</html>
